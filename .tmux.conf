# --- 核心基礎設定 ---

# 設定預設終端機與真彩色支援 (修正 Vim 顏色顯示問題)
set -g default-terminal "xterm-256color"
# 舊版用 Tc，新版建議用 RGB，這裡兩者兼容寫法
set -ag terminal-overrides ",xterm-256color:RGB"

# 啟用滑鼠 (滾動、點擊 Pane)
set -g mouse on

# 修正 Esc 鍵延遲 (對 Vim/Neovim 使用者至關重要，設為 0 或 10)
set -s escape-time 0

# 增加歷史滾動行數
set -g history-limit 50000

# 視窗與 Pane 索引從 1 開始 (配合鍵盤數字鍵習慣)
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on  # 關閉視窗後自動重新排序

# --- 介面與顯示 ---

# 狀態列位置 (macOS 使用者通常喜歡在上方，類似瀏覽器分頁)
set -g status-position top 

# 自動視窗命名
set-window-option -g automatic-rename on
set-option -g set-titles on

# --- 按鍵綁定 (Key Bindings) ---

# [重要] 重設 Prefix 為 Ctrl-a (取代預設的 Ctrl-b)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# 重新載入設定檔 (Prefix + r)
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# 分割視窗 (保留當前路徑)
# 垂直分割用 | 
bind '"' split-window -h -c "#{pane_current_path}"
# 水平分割用 -
bind '%' split-window -v -c "#{pane_current_path}"
# 新視窗保留路徑
bind c new-window -c "#{pane_current_path}"

# Vim 風格切換 Pane (h,j,k,l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 調整 Pane 大小 (大寫 H,J,K,L)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# --- 複製模式 (Copy Mode) ---

# 使用 Vi 模式
set-window-option -g mode-keys vi

# 綁定 v 開始選擇，y 複製 (類似 Vim)
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# 滑鼠拖曳結束後不要立刻退出複製模式
unbind -T copy-mode-vi MouseDragEnd1Pane

# --- 套件管理 (TPM) ---

set -g @plugin 'tmux-plugins/tpm'

# 狀態列右側顯示 Prefix 提示 (讓你知道按下了 Ctrl-a)
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g status-right '#{prefix_highlight} | %a %Y-%m-%d %H:%M'

# Session 保存與自動恢復
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'

# 初始化 TPM (必須放在最底部)
run '~/.tmux/plugins/tpm/tpm'
